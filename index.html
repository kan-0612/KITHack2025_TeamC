<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Gohan App</title>
<style>
  body { font-family: sans-serif; }
  #chat { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; margin-bottom: 10px;}
  .btn { margin: 5px; padding: 5px 10px; cursor: pointer; border: 1px solid #333; border-radius: 5px; }
</style>
</head>
<body>

<div id="chat"></div>
<div id="buttons"></div>

<script>
const chat = document.getElementById('chat');
const buttonsDiv = document.getElementById('buttons');

let step = 0;
let answers = {};

const questions = [
  { key: 'budget', question: "ã”äºˆç®—ã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ", options: ["500å††ä»¥ä¸‹", "501ã€œ1000å††", "1001å††ä»¥ä¸Š"] },
  { key: 'place', question: "å ´æ‰€ã¯ã©ã¡ã‚‰ã§ã™ã‹ï¼Ÿ", options: ["å­¦å†…", "å­¦å¤–"] },
  { key: 'people', question: "äººæ•°ã¯ï¼Ÿ", options: ["1äºº", "2äºº", "3äººä»¥ä¸Š"] },
  { key: 'genre', question: "ã‚¸ãƒ£ãƒ³ãƒ«ã¯ï¼Ÿ", options: ["å’Œé£Ÿ", "æ´‹é£Ÿ", "ä¸­è¯"] },
  { key: 'takeout', question: "ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã¯å¸Œæœ›ã—ã¾ã™ã‹ï¼Ÿ", options: ["Yes", "No"] }
];

function showNextQuestion(){
  buttonsDiv.innerHTML = "";
  if(step >= questions.length){
    chat.innerHTML += `<div>ã‚¢ãƒ—ãƒª: æ¡ä»¶ãŒæƒã„ã¾ã—ãŸï¼ãŠã™ã™ã‚ã®ãŠåº—ã‚’æ¢ã—ã¾ã™â€¦</div>`;
    
    // GASã«å•ã„åˆã‚ã›
    google.script.run.withSuccessHandler(displayShops).getShops(answers);
    return;
  }
  
  const q = questions[step];
  chat.innerHTML += `<div>ã‚¢ãƒ—ãƒª: ${q.question}</div>`;
  
  q.options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.textContent = opt;
    btn.onclick = () => selectOption(q.key, opt);
    buttonsDiv.appendChild(btn);
  });
}

function selectOption(key, value){
  answers[key] = value;
  chat.innerHTML += `<div>ã‚ãªãŸ: ${value}</div>`;
  step++;
  showNextQuestion();
}

function displayShops(shops){
  if(shops.length === 0){
    chat.innerHTML += `<div>ã‚¢ãƒ—ãƒª: æ¡ä»¶ã«åˆã†ãŠåº—ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸğŸ˜¢</div>`;
  } else {
    shops.forEach(shop => {
      chat.innerHTML += `<div>ã‚¢ãƒ—ãƒª: ãŠã™ã™ã‚ã¯ã€Œ${shop.name}ã€ã§ã™ï¼ğŸœ</div>`;
    });
  }
}

// åˆæœŸè³ªå•è¡¨ç¤º
showNextQuestion();
</script>

</body>
</html>
